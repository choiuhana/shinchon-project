# 신촌몬테소리유치원 웹사이트 기능 명세서

## 문서 개요

본 문서는 신촌몬테소리유치원 웹사이트의 각 기능에 대한 상세 명세를 정의합니다.
개발자는 이 문서를 기반으로 시스템을 구현해야 합니다.
UI 구현은 shadcn/ui 컴포넌트 라이브러리를 기본으로 하며, Tailwind CSS 커스터마이징을 통해 브랜드 아이덴티티를 반영합니다.

---

## 1. 회원 관리 시스템

### 1.1 회원 가입

#### 기능 설명
- 예비 학부모 및 재원생 학부모의 회원 가입 처리
- 이메일 인증 및 휴대폰 인증

#### 입력 데이터
| 필드명 | 타입 | 필수 | 제약조건 | 설명 |
|--------|------|------|----------|------|
| user_type | enum | O | 'parent', 'prospect' | 회원 유형 |
| name | string | O | 2~20자 | 이름 |
| email | string | O | 이메일 형식, 중복 불가 | 이메일 (ID로 사용) |
| password | string | O | 8~20자, 영문+숫자+특수문자 | 비밀번호 |
| phone | string | O | 010-0000-0000, 중복 불가 | 휴대폰 번호 |
| address | string | X | 최대 200자 | 주소 |
| children | array<object> | O* | 0~3명, 각 객체는 `Child` 스키마 준수 | 자녀 정보 목록 (재원생 학부모 필수) |
| agree_privacy | boolean | O | true만 허용 | 개인정보 동의 |
| agree_terms | boolean | O | true만 허용 | 이용약관 동의 |
| agree_marketing | boolean | X | - | 마케팅 동의 |

`Child` 스키마

| 필드명 | 타입 | 필수 | 제약조건 | 설명 |
|--------|------|------|----------|------|
| name | string | O | 2~20자 | 자녀 이름 |
| birth | date | O | YYYY-MM-DD | 자녀 생년월일 |
| class_id | string | O | 사전에 정의된 반 코드 | 자녀 반 |

#### 처리 프로세스
```
1. 약관 동의 화면 표시
2. 동의 여부 확인 (필수 항목)
3. 정보 입력 화면 표시
4. 입력값 유효성 검사 (클라이언트)
5. 자녀 정보 입력 (최대 3명, 재원생 학부모는 최소 1명 필수)
6. 휴대폰 인증
    5-1. 인증번호 발송 (SMS)
    5-2. 인증번호 입력
    5-3. 인증 확인 (3분 제한)
7. 서버로 데이터 전송
8. 입력값 유효성 검사 (서버)
9. 이메일/휴대폰 중복 체크
10. 자녀 정보 개수·반 유효성 검증
11. 비밀번호 해시화
12. DB 저장 (트랜잭션)
13. 회원가입 완료 이메일 발송
14. 가입 완료 화면 표시
```

#### 유효성 검사 규칙
- **이름**: 한글/영문 2~20자
- **이메일**: RFC 5322 표준 형식, 중복 불가
- **비밀번호**: 
  - 8~20자
  - 영문 대소문자, 숫자, 특수문자 중 3가지 이상 조합
  - 연속 3자 이상 동일 문자 불가
  - 이메일과 동일 불가
- **휴대폰**: 010-XXXX-XXXX 형식, 중복 불가
- **자녀 정보**:
  - 재원생 학부모는 `children` 배열에 최소 1명 등록
  - 각 자녀는 고유한 이름/생년월일 조합이어야 하며 동일 학급이라도 중복 입력 허용 안 함
  - `class_id`는 운영 중인 반 코드 목록과 일치해야 함

#### 에러 처리
| 에러 코드 | 메시지 | 처리 |
|-----------|--------|------|
| E001 | 이미 가입된 이메일입니다 | 로그인 페이지 안내 |
| E002 | 이미 가입된 휴대폰 번호입니다 | 아이디 찾기 안내 |
| E003 | 비밀번호 형식이 올바르지 않습니다 | 입력창 포커스 |
| E004 | 인증번호가 일치하지 않습니다 | 재발송 버튼 활성화 |
| E005 | 인증 시간이 만료되었습니다 | 재발송 버튼 활성화 |

#### API 명세
```
POST /api/auth/register

Request Body:
{
  "user_type": "parent",
  "name": "홍길동",
  "email": "hong@example.com",
  "password": "Pass123!@#",
  "phone": "010-1234-5678",
  "address": "서울시 서대문구...",
  "child_name": "홍아름",
  "child_birth": "2020-03-15",
  "child_class": "4세 바람반",
  "agree_privacy": true,
  "agree_terms": true,
  "agree_marketing": false
}

Response (Success):
{
  "status": "success",
  "message": "회원가입이 완료되었습니다",
  "data": {
    "user_id": 123,
    "email": "hong@example.com"
  }
}

Response (Error):
{
  "status": "error",
  "code": "E001",
  "message": "이미 가입된 이메일입니다"
}
```

---

### 1.2 로그인

#### 기능 설명
- 이메일과 비밀번호를 사용한 일반 로그인
- 소셜 로그인 (네이버, 카카오, 구글) - 선택 기능
- 로그인 유지 기능

#### 입력 데이터
| 필드명 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| email | string | O | 이메일 (ID) |
| password | string | O | 비밀번호 |
| remember_me | boolean | X | 로그인 유지 여부 |

#### 처리 프로세스
```
1. 이메일/비밀번호 입력
2. 서버로 전송
3. 이메일 존재 여부 확인
4. 비밀번호 검증 (해시 비교)
5. 로그인 성공 시:
   5-1. 세션/토큰 생성
   5-2. remember_me가 true면 쿠키 저장 (30일)
   5-3. 로그인 기록 저장 (IP, 시간)
   5-4. 리다이렉트 (이전 페이지 또는 마이페이지)
6. 로그인 실패 시:
   6-1. 실패 횟수 증가
   6-2. 5회 실패 시 계정 잠금 (30분)
   6-3. 에러 메시지 표시
```

#### 보안 요구사항
- HTTPS 필수
- 비밀번호 평문 전송 금지
- 실패 횟수 제한 (5회)
- 계정 잠금 (5회 실패 시 30분)
- IP 기반 로그인 시도 제한
- 세션 타임아웃 (30분 미활동 시)
- CSRF 토큰 사용

#### API 명세
```
POST /api/auth/login

Request Body:
{
  "email": "hong@example.com",
  "password": "Pass123!@#",
  "remember_me": true
}

Response (Success):
{
  "status": "success",
  "message": "로그인 성공",
  "data": {
    "user_id": 123,
    "name": "홍길동",
    "token": "eyJhbGciOiJIUzI1NiIs...",
    "expires_at": "2025-10-23T12:00:00Z"
  }
}

Response (Error):
{
  "status": "error",
  "code": "E101",
  "message": "이메일 또는 비밀번호가 일치하지 않습니다",
  "retry_count": 3,
  "max_retry": 5
}
```

---

### 1.3 비밀번호 찾기/재설정

#### 기능 설명
- 이메일을 통한 비밀번호 재설정
- 임시 토큰 생성 및 검증

#### 처리 프로세스
```
1. "비밀번호 찾기" 클릭
2. 이메일 입력
3. 이메일 존재 여부 확인
4. 재설정 토큰 생성 (유효기간 1시간)
5. 재설정 링크 이메일 발송
6. 사용자가 이메일에서 링크 클릭
7. 토큰 유효성 검증
8. 새 비밀번호 입력 화면
9. 새 비밀번호 입력 및 확인
10. 비밀번호 업데이트
11. 완료 메시지 및 로그인 페이지로 리다이렉트
```

#### API 명세
```
# 1단계: 재설정 링크 요청
POST /api/auth/password-reset/request

Request Body:
{
  "email": "hong@example.com"
}

Response:
{
  "status": "success",
  "message": "비밀번호 재설정 링크가 이메일로 발송되었습니다"
}

# 2단계: 토큰 검증
GET /api/auth/password-reset/verify?token={token}

Response:
{
  "status": "success",
  "message": "유효한 토큰입니다"
}

# 3단계: 비밀번호 재설정
POST /api/auth/password-reset/confirm

Request Body:
{
  "token": "abc123...",
  "new_password": "NewPass123!@#",
  "confirm_password": "NewPass123!@#"
}

Response:
{
  "status": "success",
  "message": "비밀번호가 변경되었습니다"
}
```

### 1.4 회원정보 수정

#### 기능 설명
- 학부모가 기본 인적 사항 및 자녀 정보를 확인·수정
- 최대 3명의 자녀 정보를 추가/삭제
- 연락처 재인증 및 비밀번호 변경 진입점 제공

#### UI 요구사항
- 이름, 이메일은 읽기 전용으로 표시
- 휴대폰 번호는 단일 입력 필드(자동 하이픈)로 제공하고, 변경 시 SMS 재인증 진행
- 주소는 우편번호 검색 모달 + 상세 주소 입력 2단 구성
- 자녀 정보는 동적 리스트 UI(카드 또는 행)로 제공하고, 각 행에 `이름/생년월일/반` 필드를 포함
- 자녀 추가 버튼 클릭 시 빈 행을 생성하고, 3명 등록 시 버튼 비활성화
- 각 행에는 삭제 버튼과 필수 필드 유효성 상태 표시
- 비밀번호 변경은 별도 모달 또는 페이지로 이동

#### 데이터 모델
```sql
CREATE TABLE parent_children (
  id INT PRIMARY KEY AUTO_INCREMENT,
  parent_id INT NOT NULL,
  name VARCHAR(20) NOT NULL,
  birth DATE NOT NULL,
  class_id VARCHAR(50) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (parent_id) REFERENCES users(id) ON DELETE CASCADE
);
```

#### 처리 프로세스
```
1. 회원정보 조회 API 호출 → 기본 정보 + children 목록 로드
2. 사용자가 필드 수정
3. 저장 클릭 시 클라이언트 유효성 검사
4. 휴대폰 번호 변경이 있을 경우:
   4-1. SMS 인증번호 요청
   4-2. 인증번호 검증 성공 후 이어서 제출
5. 서버로 PATCH 요청 전송
6. 서버에서 필드 검증 (이메일 변경 불가, 자녀 중복 검증 등)
7. 트랜잭션 처리 (users + parent_children)
8. 성공 응답 및 화면 토스트 알림
```

#### API 명세
```
GET /api/me
PATCH /api/me
```

`PATCH /api/me` Request Body 예시:
```json
{
  "phone": "01012345678",
  "address": {
    "postal_code": "04094",
    "line1": "서울 마포구 광성로 17",
    "line2": "106-605"
  },
  "children": [
    {
      "name": "최유하",
      "birth": "2020-05-12",
      "class_id": "rose"
    }
  ],
  "password_change_token": null
}
```

- `password_change_token`은 비밀번호 변경 모듈이 발급한 임시 토큰(선택)
- 응답 본문은 최신 프로필 데이터를 반환

---

## 2. 게시판 시스템

### 2.1 공지사항 게시판

#### 기능 설명
- 공지사항 목록 조회, 상세 조회, 작성, 수정, 삭제
- 중요 공지 상단 고정
- 검색 및 필터링
- 첨부파일 관리

#### 데이터 모델
```sql
CREATE TABLE notices (
  id INT PRIMARY KEY AUTO_INCREMENT,
  category VARCHAR(20) NOT NULL,  -- '입학', '행사', '교육', '급식', '안전'
  title VARCHAR(200) NOT NULL,
  content TEXT NOT NULL,
  author_id INT NOT NULL,  -- 관리자 ID
  is_important BOOLEAN DEFAULT FALSE,  -- 중요 공지 여부
  view_count INT DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted_at TIMESTAMP NULL,  -- Soft delete
  FOREIGN KEY (author_id) REFERENCES users(id)
);

CREATE TABLE notice_attachments (
  id INT PRIMARY KEY AUTO_INCREMENT,
  notice_id INT NOT NULL,
  file_name VARCHAR(255) NOT NULL,
  file_path VARCHAR(500) NOT NULL,
  file_size INT NOT NULL,
  file_type VARCHAR(50) NOT NULL,
  download_count INT DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (notice_id) REFERENCES notices(id) ON DELETE CASCADE
);
```

#### 목록 조회 API
```
GET /api/notices?page={page}&category={category}&keyword={keyword}

Query Parameters:
- page: 페이지 번호 (기본값: 1)
- limit: 페이지당 게시글 수 (기본값: 10)
- category: 카테고리 필터 (선택)
- keyword: 검색 키워드 (선택)
- search_type: 검색 유형 (title, content, author) (기본값: title)

Response:
{
  "status": "success",
  "data": {
    "items": [
      {
        "id": 184,
        "category": "입학",
        "title": "2026학년도 신촌유치원 입학설명회",
        "author": "관리자",
        "is_important": true,
        "view_count": 104,
        "created_at": "2025-10-15T10:00:00Z"
      },
      ...
    ],
    "pagination": {
      "total": 120,
      "page": 1,
      "limit": 10,
      "total_pages": 12,
      "has_prev": false,
      "has_next": true
    }
  }
}
```

#### 상세 조회 API
```
GET /api/notices/{id}

Response:
{
  "status": "success",
  "data": {
    "id": 184,
    "category": "입학",
    "title": "2026학년도 신촌유치원 입학설명회",
    "content": "2026학년도 신입생을 위한 입학설명회를 다음과 같이 개최합니다...",
    "author": {
      "id": 1,
      "name": "관리자"
    },
    "is_important": true,
    "view_count": 105,
    "attachments": [
      {
        "id": 1,
        "file_name": "입학설명회_안내문.pdf",
        "file_size": 524288,
        "download_count": 15
      }
    ],
    "created_at": "2025-10-15T10:00:00Z",
    "updated_at": "2025-10-15T10:00:00Z",
    "prev_post": {
      "id": 183,
      "title": "2024학년도 신촌유치원 결산서"
    },
    "next_post": null
  }
}
```

#### 작성 API (관리자 전용)
```
POST /api/notices

Request Body:
{
  "category": "입학",
  "title": "2026학년도 신촌유치원 입학설명회",
  "content": "2026학년도 신입생을 위한...",
  "is_important": true,
  "attachments": [
    {
      "file_name": "입학설명회_안내문.pdf",
      "file_data": "base64_encoded_data..."
    }
  ]
}

Response:
{
  "status": "success",
  "message": "공지사항이 등록되었습니다",
  "data": {
    "id": 185,
    "title": "2026학년도 신촌유치원 입학설명회"
  }
}
```

#### 조회수 증가 로직
- 쿠키 또는 세션을 사용하여 중복 조회 방지
- 24시간 내 동일 IP/세션에서 재조회 시 카운트 증가 안 함
- 관리자 조회 시 카운트 증가 안 함

---

### 2.2 반 소식 게시판 (로그인 필요)

#### 기능 설명
- 교사가 반별 활동 소식 작성
- 학부모가 댓글 작성
- 사진 다중 업로드
- 반별 접근 권한 관리

#### 데이터 모델
```sql
CREATE TABLE class_posts (
  id INT PRIMARY KEY AUTO_INCREMENT,
  class_id INT NOT NULL,  -- 반 ID
  teacher_id INT NOT NULL,  -- 교사 ID
  title VARCHAR(200),  -- 선택
  content TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (class_id) REFERENCES classes(id),
  FOREIGN KEY (teacher_id) REFERENCES users(id)
);

CREATE TABLE class_post_images (
  id INT PRIMARY KEY AUTO_INCREMENT,
  post_id INT NOT NULL,
  image_path VARCHAR(500) NOT NULL,
  image_order INT NOT NULL,  -- 이미지 순서
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (post_id) REFERENCES class_posts(id) ON DELETE CASCADE
);

CREATE TABLE class_post_comments (
  id INT PRIMARY KEY AUTO_INCREMENT,
  post_id INT NOT NULL,
  user_id INT NOT NULL,  -- 학부모 ID
  content TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (post_id) REFERENCES class_posts(id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES users(id)
);
```

#### 권한 관리
- **교사**: 
  - 자신의 반 게시글 작성, 수정, 삭제
  - 모든 댓글 조회 및 삭제
- **학부모**:
  - 자녀가 속한 반 게시글 조회
  - 댓글 작성, 자신의 댓글 수정/삭제
- **관리자**:
  - 모든 반 조회
  - 모든 게시글/댓글 관리

#### API 명세
```
# 목록 조회 (피드 형식)
GET /api/class-posts?class_id={class_id}&page={page}

Response:
{
  "status": "success",
  "data": {
    "items": [
      {
        "id": 1,
        "class": {
          "id": 3,
          "name": "4세 바람반"
        },
        "teacher": {
          "id": 5,
          "name": "김선생님",
          "profile_image": "/images/teachers/kim.jpg"
        },
        "title": "오늘의 활동",
        "content": "오늘은 몬테소리 교구를 이용하여...",
        "images": [
          {
            "id": 1,
            "url": "/uploads/class_posts/2025/10/22/image1.jpg",
            "order": 1
          },
          {
            "id": 2,
            "url": "/uploads/class_posts/2025/10/22/image2.jpg",
            "order": 2
          }
        ],
        "comment_count": 5,
        "created_at": "2025-10-22T14:30:00Z"
      },
      ...
    ],
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 45,
      "has_next": true
    }
  }
}

# 게시글 작성 (교사)
POST /api/class-posts

Request Body (multipart/form-data):
{
  "class_id": 3,
  "title": "오늘의 활동",
  "content": "오늘은 몬테소리 교구를 이용하여...",
  "images": [File, File, ...]  // 최대 10개
}

Response:
{
  "status": "success",
  "message": "게시글이 등록되었습니다",
  "data": {
    "id": 1,
    "created_at": "2025-10-22T14:30:00Z"
  }
}

# 댓글 작성
POST /api/class-posts/{post_id}/comments

Request Body:
{
  "content": "오늘도 즐겁게 활동하는 모습이 보기 좋네요!"
}

Response:
{
  "status": "success",
  "message": "댓글이 등록되었습니다",
  "data": {
    "id": 15,
    "user": {
      "id": 123,
      "name": "홍길동"
    },
    "content": "오늘도 즐겁게 활동하는 모습이 보기 좋네요!",
    "created_at": "2025-10-22T15:00:00Z"
  }
}
```

---

## 3. 급식 관리 시스템

### 3.1 식단표 관리

#### 기능 설명
- 월별 식단 등록 및 관리
- 알레르기 정보 표시
- 영양 정보 제공
- PDF 다운로드

#### 데이터 모델
```sql
CREATE TABLE meals (
  id INT PRIMARY KEY AUTO_INCREMENT,
  meal_date DATE NOT NULL,
  meal_type VARCHAR(20) NOT NULL,  -- 'lunch', 'snack_am', 'snack_pm'
  rice VARCHAR(100),  -- 밥
  soup VARCHAR(100),  -- 국
  main_dish VARCHAR(200),  -- 주요 반찬
  side_dishes TEXT,  -- 부반찬 (JSON 배열)
  dessert VARCHAR(100),  -- 후식
  allergens TEXT,  -- 알레르기 유발 식재료 (JSON 배열)
  calories INT,  -- 칼로리
  protein DECIMAL(5,2),  -- 단백질 (g)
  carbohydrate DECIMAL(5,2),  -- 탄수화물 (g)
  fat DECIMAL(5,2),  -- 지방 (g)
  origin_info TEXT,  -- 원산지 정보 (JSON)
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_meal_date_type (meal_date, meal_type)
);
```

#### API 명세
```
# 월별 식단 조회
GET /api/meals?year={year}&month={month}

Query Parameters:
- year: 연도 (예: 2025)
- month: 월 (1~12)

Response:
{
  "status": "success",
  "data": {
    "year": 2025,
    "month": 10,
    "meals": [
      {
        "date": "2025-10-01",
        "lunch": {
          "id": 1,
          "rice": "잡곡밥",
          "soup": "아욱된장국",
          "main_dish": "코다리감자조림",
          "side_dishes": ["고구마순나물", "구이김"],
          "dessert": null,
          "allergens": ["대두", "밀"],
          "nutrition": {
            "calories": 450,
            "protein": 18.5,
            "carbohydrate": 65.2,
            "fat": 12.3
          }
        },
        "snack_am": null,
        "snack_pm": null
      },
      {
        "date": "2025-10-02",
        "lunch": {
          "id": 2,
          "rice": "한우콩나물비빔밥",
          "soup": null,
          "main_dish": "양송이버섯떡갈비",
          "side_dishes": ["배추김치"],
          "dessert": "메론",
          "allergens": ["대두", "쇠고기"],
          "nutrition": {
            "calories": 520,
            "protein": 22.3,
            "carbohydrate": 70.1,
            "fat": 15.8
          }
        }
      },
      ...
    ],
    "summary": {
      "total_days": 20,  // 급식 제공 일수
      "avg_calories": 485
    }
  }
}

# 특정 날짜 식단 상세 조회
GET /api/meals/{date}

Response:
{
  "status": "success",
  "data": {
    "date": "2025-10-01",
    "lunch": {
      "id": 1,
      "rice": "잡곡밥",
      "soup": "아욱된장국",
      "main_dish": "코다리감자조림",
      "side_dishes": ["고구마순나물", "구이김"],
      "dessert": null,
      "allergens": [
        {
          "name": "대두",
          "type": "식물성"
        },
        {
          "name": "밀",
          "type": "곡류"
        }
      ],
      "nutrition": {
        "calories": 450,
        "protein": 18.5,
        "carbohydrate": 65.2,
        "fat": 12.3,
        "sodium": 850
      },
      "origin_info": {
        "rice": "국내산",
        "beef": "한우 (국내산)",
        "pork": "국내산",
        "chicken": "국내산"
      }
    }
  }
}

# 식단 등록/수정 (관리자)
POST /api/meals

Request Body:
{
  "meal_date": "2025-10-01",
  "meal_type": "lunch",
  "rice": "잡곡밥",
  "soup": "아욱된장국",
  "main_dish": "코다리감자조림",
  "side_dishes": ["고구마순나물", "구이김"],
  "dessert": null,
  "allergens": ["대두", "밀"],
  "calories": 450,
  "protein": 18.5,
  "carbohydrate": 65.2,
  "fat": 12.3,
  "origin_info": {
    "rice": "국내산",
    "beef": "한우 (국내산)"
  }
}

Response:
{
  "status": "success",
  "message": "식단이 등록되었습니다",
  "data": {
    "id": 1,
    "meal_date": "2025-10-01"
  }
}

# 식단표 PDF 다운로드
GET /api/meals/download?year={year}&month={month}&format=pdf

Response: PDF file download
```

#### 알레르기 정보 표시 규칙
- 주요 알레르기 유발 식재료 18종 표시
  - 난류, 우유, 메밀, 땅콩, 대두, 밀, 고등어, 게, 새우, 돼지고기, 복숭아, 토마토, 아황산류, 호두, 닭고기, 쇠고기, 오징어, 조개류
- 해당 식재료 사용 시 아이콘 또는 색상으로 강조
- 상세 페이지에서 알레르기 유형 및 주의사항 표시

---

## 4. 파일 관리 시스템

### 4.1 파일 업로드

#### 기능 설명
- 이미지, 문서, 영상 등 다양한 파일 업로드
- 파일 크기 제한 및 형식 검증
- 섬네일 자동 생성 (이미지)

#### 허용 파일 형식
| 유형 | 확장자 | 최대 크기 |
|------|--------|-----------|
| 이미지 | jpg, jpeg, png, gif, webp | 5MB |
| 문서 | pdf, doc, docx, xls, xlsx, hwp | 10MB |
| 압축 | zip, rar | 20MB |
| 비디오 | mp4, mov (제한적) | 100MB |

#### 저장 구조
```
/uploads/
  ├── notices/            # 공지사항 첨부
  │   └── 2025/
  │       └── 10/
  │           └── {uuid}.pdf
  ├── class_posts/        # 반 소식 사진
  │   └── 2025/
  │       └── 10/
  │           ├── {uuid}.jpg
  │           └── thumb_{uuid}.jpg  # 섬네일
  ├── gallery/            # 포토 갤러리
  │   └── 2025/
  │       └── 10/
  │           └── event_name/
  │               ├── {uuid}.jpg
  │               └── thumb_{uuid}.jpg
  └── forms/              # 서식 자료
      └── {category}/
          └── {filename}.pdf
```

#### API 명세
```
POST /api/files/upload

Request (multipart/form-data):
{
  "file": File,
  "type": "image",  // 'image', 'document', 'archive'
  "category": "class_posts",  // 'notices', 'class_posts', 'gallery', 'forms'
  "generate_thumbnail": true  // 이미지인 경우
}

Response:
{
  "status": "success",
  "message": "파일이 업로드되었습니다",
  "data": {
    "file_id": "abc123",
    "file_name": "photo.jpg",
    "file_path": "/uploads/class_posts/2025/10/abc123.jpg",
    "file_size": 524288,
    "file_type": "image/jpeg",
    "thumbnail_path": "/uploads/class_posts/2025/10/thumb_abc123.jpg",
    "url": "https://shinchonkid.com/uploads/class_posts/2025/10/abc123.jpg"
  }
}
```

#### 이미지 최적화
- JPEG: 80% 품질로 압축
- PNG: TinyPNG 또는 유사 도구로 압축
- WebP 변환 (선택)
- 섬네일 크기: 300x300 (비율 유지, crop)
- 최대 해상도 제한: 1920x1080

---

## 5. 검색 기능

### 5.1 통합 검색

#### 기능 설명
- 사이트 전체 검색
- 게시판별 검색
- 자동완성 (선택)

#### 검색 대상
- 공지사항 (제목, 내용)
- 가정통신문 (제목, 내용)
- 포토 갤러리 (앨범명, 설명)
- FAQ (질문, 답변)

#### API 명세
```
GET /api/search?q={keyword}&type={type}&page={page}

Query Parameters:
- q: 검색 키워드 (2자 이상)
- type: 검색 대상 (all, notices, newsletters, gallery, faq)
- page: 페이지 번호
- limit: 페이지당 결과 수 (기본값: 10)

Response:
{
  "status": "success",
  "data": {
    "keyword": "입학",
    "total_count": 35,
    "results_by_type": {
      "notices": {
        "count": 15,
        "items": [
          {
            "id": 184,
            "type": "notice",
            "title": "2026학년도 신촌유치원 입학설명회",
            "snippet": "...2026학년도 신입생을 위한 <em>입학</em>설명회를...",
            "url": "/notice/announcements/184",
            "date": "2025-10-15"
          },
          ...
        ]
      },
      "faq": {
        "count": 12,
        "items": [...]
      },
      "newsletters": {
        "count": 8,
        "items": [...]
      }
    },
    "pagination": {
      "page": 1,
      "limit": 10,
      "total_pages": 4
    }
  }
}
```

#### 검색 최적화
- 전문 검색(Full-text Search) 사용
- 인덱스 생성: title, content
- 검색 로그 저장 (인기 검색어 분석)
- 캐싱 (자주 검색되는 키워드)

---

## 6. 알림 시스템

### 6.1 이메일 알림

#### 발송 시나리오
1. **회원 가입**
   - 제목: "[신촌유치원] 회원가입을 환영합니다"
   - 내용: 가입 축하, 로그인 정보, 주요 메뉴 안내

2. **비밀번호 재설정**
   - 제목: "[신촌유치원] 비밀번호 재설정 안내"
   - 내용: 재설정 링크 (1시간 유효)

3. **공지사항 등록** (중요 공지)
   - 제목: "[신촌유치원] 새로운 공지사항: {제목}"
   - 내용: 공지 요약, 상세 링크

4. **1:1 문의 답변**
   - 제목: "[신촌유치원] 문의하신 내용에 대한 답변입니다"
   - 내용: 원본 문의, 답변 내용

5. **반 소식 등록** (자녀 반)
   - 제목: "[신촌유치원] {반명} 새로운 소식이 등록되었습니다"
   - 내용: 소식 요약, 상세 링크

#### 이메일 템플릿 구조
```html
<!DOCTYPE html>
<html>
<head>
  <style>
    /* 반응형 이메일 CSS */
  </style>
</head>
<body>
  <div class="email-container">
    <div class="header">
      <img src="{logo_url}" alt="신촌유치원">
    </div>
    <div class="content">
      <h1>{title}</h1>
      <p>{content}</p>
      <a href="{action_url}" class="button">자세히 보기</a>
    </div>
    <div class="footer">
      <p>신촌몬테소리유치원</p>
      <p>서울특별시 서대문구 신촌로 43</p>
      <p>02-324-0671</p>
      <p><a href="{unsubscribe_url}">수신거부</a></p>
    </div>
  </div>
</body>
</html>
```

#### API 명세
```
POST /api/notifications/email

Request Body:
{
  "to": ["hong@example.com"],
  "template": "notice_new",
  "data": {
    "title": "2026학년도 신촌유치원 입학설명회",
    "content": "2026학년도 신입생을 위한 입학설명회를...",
    "action_url": "https://shinchonkid.com/notice/announcements/184"
  }
}

Response:
{
  "status": "success",
  "message": "이메일이 발송되었습니다",
  "data": {
    "email_id": "abc123",
    "sent_count": 1
  }
}
```

### 6.2 알림톡 (선택 기능)

#### 발송 시나리오
1. 급식 식단 업데이트 (매주 월요일)
2. 중요 공지사항 등록
3. 행사 안내 (3일 전)
4. 1:1 문의 답변

#### 카카오 알림톡 연동
- 비즈니스 채널 등록
- 템플릿 승인 필요
- API 키 발급 및 설정

---

## 7. 통계 및 분석

### 7.1 방문자 통계

#### 수집 데이터
- 방문자 수 (UV, PV)
- 페이지별 조회수
- 유입 경로 (직접, 검색, SNS 등)
- 접속 기기 (모바일, 태블릿, PC)
- 접속 브라우저
- 접속 지역
- 체류 시간
- 이탈률

#### API 명세
```
GET /api/statistics/visitors?start_date={start}&end_date={end}

Response:
{
  "status": "success",
  "data": {
    "period": {
      "start": "2025-10-01",
      "end": "2025-10-31"
    },
    "summary": {
      "total_visitors": 1250,
      "total_pageviews": 4800,
      "avg_pageviews_per_visitor": 3.84,
      "avg_session_duration": "00:03:45",
      "bounce_rate": 42.5
    },
    "daily_visitors": [
      {
        "date": "2025-10-01",
        "visitors": 45,
        "pageviews": 180
      },
      ...
    ],
    "device_stats": {
      "mobile": 62.5,
      "tablet": 15.2,
      "desktop": 22.3
    },
    "traffic_sources": {
      "direct": 35.0,
      "search": 45.0,
      "social": 15.0,
      "referral": 5.0
    },
    "top_pages": [
      {
        "url": "/notice/meal",
        "title": "급식 안내",
        "pageviews": 850
      },
      {
        "url": "/admission/process",
        "title": "입학 절차",
        "pageviews": 620
      },
      ...
    ]
  }
}
```

#### Google Analytics 연동
- GA4 추적 코드 삽입
- 이벤트 설정
  - 회원가입
  - 상담 신청
  - 원서 접수
  - 파일 다운로드
- 전환 목표 설정
- 맞춤 리포트 생성

---

## 8. 보안 요구사항

### 8.1 인증 및 인가
- JWT 토큰 기반 인증
- 토큰 만료 시간: 1시간 (Access Token), 30일 (Refresh Token)
- Role-based Access Control (RBAC)
  - admin: 모든 권한
  - teacher: 반 관리, 게시글 작성
  - parent: 읽기, 댓글 작성
  - guest: 공개 페이지 읽기

### 8.2 데이터 보호
- 개인정보 암호화 (AES-256)
- 비밀번호 해싱 (bcrypt, salt rounds: 10)
- HTTPS 강제
- SQL Injection 방지 (Prepared Statement)
- XSS 방지 (입력값 이스케이프)
- CSRF 토큰 사용

### 8.3 파일 보안
- 파일 업로드 시 확장자 검증
- MIME 타입 검증
- 파일명 난독화 (UUID 사용)
- 실행 파일 업로드 차단
- 바이러스 검사 (선택)

### 8.4 API 보안
- Rate Limiting (분당 100회)
- API 키 발급 및 검증
- CORS 설정
- 요청 로깅

---

## 9. 성능 최적화

### 9.1 캐싱 전략
- **브라우저 캐시**: 정적 리소스 (이미지, CSS, JS) - 30일
- **서버 캐시**: 자주 조회되는 데이터 (Redis) - 1시간
- **CDN**: 정적 리소스 배포
- **페이지 캐시**: 변경 빈도 낮은 페이지 - 10분

### 9.2 데이터베이스 최적화
- 인덱스 생성
  - users: email, phone
  - notices: created_at, category
  - meals: meal_date
- 쿼리 최적화 (N+1 문제 해결)
- 커넥션 풀 설정
- 슬로우 쿼리 로깅

### 9.3 이미지 최적화
- Lazy Loading
- Responsive Images (srcset)
- 이미지 압축
- WebP 포맷 사용 (브라우저 지원 시)

### 9.4 코드 최적화
- JS/CSS 번들링 및 최소화
- Tree Shaking
- Code Splitting
- Gzip 압축

---

## 10. 테스트 시나리오

### 10.1 회원가입 테스트
```
[테스트 케이스 1: 정상 회원가입]
- 입력: 유효한 모든 필드
- 기대 결과: 가입 성공, 이메일 발송

[테스트 케이스 2: 중복 이메일]
- 입력: 이미 가입된 이메일
- 기대 결과: 에러 메시지 (E001)

[테스트 케이스 3: 비밀번호 형식 오류]
- 입력: 7자 비밀번호
- 기대 결과: 유효성 검사 실패

[테스트 케이스 4: 필수 항목 누락]
- 입력: 이름 누락
- 기대 결과: 필수 항목 오류
```

### 10.2 로그인 테스트
```
[테스트 케이스 1: 정상 로그인]
- 입력: 올바른 이메일/비밀번호
- 기대 결과: 로그인 성공, 토큰 발급

[테스트 케이스 2: 잘못된 비밀번호]
- 입력: 올바른 이메일, 잘못된 비밀번호
- 기대 결과: 에러 메시지, 실패 횟수 증가

[테스트 케이스 3: 계정 잠금]
- 입력: 5회 연속 실패
- 기대 결과: 계정 잠금 (30분)
```

### 10.3 게시판 테스트
```
[테스트 케이스 1: 공지사항 작성]
- 입력: 제목, 내용, 첨부파일 (관리자)
- 기대 결과: 게시글 등록 성공

[테스트 케이스 2: 권한 없는 작성 시도]
- 입력: 일반 회원이 공지사항 작성
- 기대 결과: 권한 오류 (403)

[테스트 케이스 3: 게시글 검색]
- 입력: 검색 키워드 "입학"
- 기대 결과: 관련 게시글 목록 반환
```

---

## 11. 배포 및 운영

### 11.1 배포 프로세스
```
1. 로컬 개발 환경에서 개발
2. Git 브랜치 생성 및 커밋
3. Pull Request 생성
4. 코드 리뷰
5. 테스트 서버에 배포
6. QA 테스트
7. 승인 후 프로덕션 배포
8. 배포 후 모니터링
```

### 11.2 환경 구성
```
[개발 환경]
- 로컬 개발 서버
- 개발 DB (MySQL)
- 테스트 데이터

[테스트 환경]
- 스테이징 서버
- 테스트 DB (프로덕션 복제)
- 실제 데이터 (일부)

[프로덕션 환경]
- 프로덕션 서버 (AWS/GCP/Azure)
- 프로덕션 DB (Master-Slave 구성)
- CDN
- 백업 서버
```

### 11.3 백업 전략
- 데이터베이스: 매일 자동 백업 (00:00)
- 파일: 주 1회 백업 (일요일)
- 백업 보관 기간: 30일
- 백업 저장 위치: AWS S3 또는 별도 스토리지

### 11.4 모니터링
- 서버 상태 모니터링 (CPU, 메모리, 디스크)
- 애플리케이션 로그 수집 (ELK Stack 등)
- 에러 추적 (Sentry 등)
- 가동 시간 모니터링 (Uptime Robot 등)

---

## 12. 용어 정의

| 용어 | 설명 |
|------|------|
| UV | Unique Visitor (순 방문자) |
| PV | Page View (페이지 조회수) |
| JWT | JSON Web Token |
| RBAC | Role-Based Access Control |
| CDN | Content Delivery Network |
| XSS | Cross-Site Scripting |
| CSRF | Cross-Site Request Forgery |
| SQL Injection | SQL 주입 공격 |

---

본 기능 명세서는 신촌몬테소리유치원 웹사이트의 주요 기능을 개발하기 위한 상세 스펙을 정의한 문서입니다.

개발 시 본 명세서를 준수하되, 기술적 제약이나 더 나은 방법이 있을 경우 프로젝트 관리자와 협의하여 조정 가능합니다.

**문서 버전:** 1.0  
**작성일:** 2025년 10월 22일
